## 虚拟现实技术 2021 秋 - 小作业 1

<div style="float:none"><font style="float:right">计 93 王哲凡 2019011200</font></div>

### 1. 模型变换

缩放矩阵为：
$$
A_1 = 
\begin{pmatrix}
2 & 0 & 0 & 0 \\
0 & 3 & 0 & 0 \\
0 & 0 & 3 & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$
旋转矩阵为：
$$
A_2 =
\begin{pmatrix}
-1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & -1 & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$
平移矩阵为：
$$
A_3 =
\begin{pmatrix}
1 & 0 & 0 & 2 \\
0 & 1 & 0 & 1 \\
0 & 0 & 1 & 3 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$
$\mathbf{p}$ 经过变换后：
$$
A_3 A_2 A_1
\begin{pmatrix}
\mathbf{p} \\
1
\end{pmatrix} =
\begin{pmatrix}
-2 & 0 & 0 & 2 \\
0 & 3 & 0 & 1 \\
0 & 0 & -3 & 3 \\
0 & 0 & 0 & 1
\end{pmatrix}
\begin{pmatrix}
5 \\
2 \\
2 \\
1
\end{pmatrix} =
\begin{pmatrix}
-8 \\
7 \\
-3 \\
1
\end{pmatrix}
$$
因此变换后的坐标为 $\mathbf{p}_1 = (-8, 7, -3)^T$。

### 2. 视角变换

首先：
$$
\mathbf{z}^c = \frac{-\mathbf{g}}{\Vert \mathbf{g} \Vert} = \frac{\mathbf{e} - \mathbf{c}}{\Vert \mathbf{e} - \mathbf{c} \Vert} = \frac{(4, 0, -3)}{5} = \left(\frac45, 0, -\frac35\right) \\
\mathbf{x}^c = \frac{\mathbf{u} \times \mathbf{z}^c}{\Vert \mathbf{u} \times \mathbf{z}^c \Vert} = \frac{(0, 1, 0)}{1} = (0, 1, 0) \\
\mathbf{y}^c = \mathbf{z}^c \times \mathbf{x}^c = \left(\frac35, 0, \frac45\right)
$$
因此视角变换矩阵为：
$$
M_{\text{view}} = R \cdot T(-\mathbf{e}) =
\begin{pmatrix}
0 & 1 & 0 & 0 \\
\dfrac35 & 0 & \dfrac45 & 0 \\
\dfrac45 & 0 & -\dfrac35 & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
\begin{pmatrix}
1 & 0 & 0 & -4 \\
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 3 \\
0 & 0 & 0 & 1
\end{pmatrix}
=
\begin{pmatrix}
0 & 1 & 0 & 0 \\
\dfrac35 & 0 & \dfrac45 & 0 \\
\dfrac45 & 0 & -\dfrac35 & -5 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$
同理对 $\mathbf{p}$ 变换：
$$
M_{\text{view}} 
\begin{pmatrix}
\mathbf{p}_1 \\
1
\end{pmatrix}
=
\begin{pmatrix}
0 & 1 & 0 & 0 \\
\dfrac35 & 0 & \dfrac45 & 0 \\
\dfrac45 & 0 & -\dfrac35 & -5 \\
0 & 0 & 0 & 1
\end{pmatrix}
\begin{pmatrix}
-8 \\
7 \\
-3 \\
1
\end{pmatrix}
=
\begin{pmatrix}
7 \\
-\dfrac{36}{5} \\
-\dfrac{48}{5} \\
1
\end{pmatrix}
$$
因此视角变换后的坐标为 $\mathbf{p}_2 = \left(7, -\dfrac{36}{5}, -\dfrac{48}{5} \right)^T$。

### 3. 投影变换

$f = \cot(\mathrm{fovy} / 2) = 1$，透视投影矩阵为：
$$
M_{\text{proj}} =
\begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & -\dfrac53 & -8 \\
0 & 0 & -1 & 0
\end{pmatrix}
$$
截断空间坐标为：
$$
\mathbf{p}_{\text{clip}} = M_{\text{proj}}
\begin{pmatrix}
\mathbf{p}_2 \\
1
\end{pmatrix}
=
\begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & -\dfrac53 & -8 \\
0 & 0 & -1 & 0
\end{pmatrix}
\begin{pmatrix}
7 \\
-\dfrac{36}{5} \\
-\dfrac{48}{5} \\
1
\end{pmatrix}
=
\begin{pmatrix}
7 \\
-\dfrac{36}{5} \\
8 \\
\dfrac{48}{5}
\end{pmatrix}
$$
NDC 坐标为：
$$
\mathbf{p}_3 = \begin{pmatrix}
7 \\
-\dfrac{36}{5} \\
8
\end{pmatrix}
\dfrac5{48} = \left(\frac{35}{48}, -\frac{3}{4}, \frac{5}{6} \right)^T
$$

### 4. 视口变换

计算可得：
$$
x_w = \frac{l_w}{2} (x_{ndc} + 1) + 0 = \frac{2075}{8} \\
y_w = \frac{l_h}{2} (y_{ndc} + 1) + 0 = \frac{75}{2} \\
$$
故屏幕空间坐标为 $\left(\dfrac{2075}{8}, \dfrac{75}{2} \right) = (259.375, 37.5)$。

