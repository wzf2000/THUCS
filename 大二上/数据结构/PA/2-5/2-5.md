## PA2a-5 Temperature

### 一、算法分析

本题可以考虑采用 $2d-\mathrm{Tree}$ 的数据结构进行维护。

考虑对于每个节点维护其子树中的最高气温、最低气温，以及子树覆盖的矩形范围。

对于每次询问：

- 若询问矩形包含了整个子树覆盖的矩形，则直接用子树的最高、最低气温更新。
- 否则若当前节点在询问矩形当中，用当前节点的温度更新最高最低气温，并考虑两个子树：
  - 如果右子树的最高最低气温包含了左子树的最高最低气温，则先考虑右子树，否则反之。
  - 对于某个子树，仅当其覆盖矩形与询问矩形存在交集，并且气温的最小值和最大值至少一种存在更新的可能时，才尝试进入递归。

### 二、复杂度分析

考虑建树部分，由于每次递归都至多为 $O(\mathrm{len})$，其中 $\mathrm{len}$ 为点数，因此单层复杂度为 $O(n)$，而层数为 $O(\log n)$，因此时间复杂度为 $O(n \log n)$。

而询问时，根据 $2d-\mathrm{Tree}$ 的矩形划分，可知时间复杂度不超过单次 $O(\sqrt{n})$，因此整体时间复杂度为 $O(n \log n + m \sqrt{n})$。

又考虑到矩形范围内的信息维护，实际上运行时的常数会较小。

而存储时，所需节点数为 $n$，每个节点数维护了坐标、温度、左右子节点、子树覆盖矩形、子树最高最低温度、父亲等信息，因此整体空间复杂度为 $O(n)$。

### 三、问题与解决

在一开始，我采用的是根据极差来选择进行 $x$ 维还是 $y$ 维的划分，但是这样在极端情况下，会不符合 $2d-\mathrm{Tree}$ 的矩形划分，导致时间复杂度退化，修改为严格的 $x, y$ 依次划分即可解决此问题。

