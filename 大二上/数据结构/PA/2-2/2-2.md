## PA2a-2 Circuit

### 一、算法分析

先考虑对于给定若干 $01$ 串的情况，我们想要寻找与指定 $01$ 串异或最大的那个串。

可以考虑建立给定 $01$ 串的 $\mathrm{Trie}$ 树，然后根据给定的 $01$ 串从高位到低位判断：

- 如果存在与此位相反方向的子节点（`!x`），则走此方向。
- 否则走同一方向。

这样走到最后的就是我们想要的结果。

在本题中，每个串指定的是一个区间，但是这个区间的左右端点是单调的，因此可以考虑建立一个动态的 $\mathrm{Trie}$ 树，每次只需最多删除和插入一个 $01$ 串，并且通过维护最晚一次经过树上某个节点的编号（或者经过某个节点的次数），来判断此节点是否需要被删除。

通过这样的维护方式，我们对于每个串可以得到一个属于它的询问 $\mathrm{Trie}$ 树，并通过上面的算法，得到与它异或最大的串的值（$01$ 序列），但是还无法得到其编号（满足区间条件和值条件）的最小编号。

可以考虑对给定的所有串按照值（二进制下意义）为第一关键字，编号为第二关键字，进行排序，然后对于每个串，根据给定的区间和查询得到的值进行二分查找，获得答案。

也可以考虑改为倒序插入，那么末尾点存储的最晚经过的串编号就恰好是所求的答案。

### 二、复杂度分析

每次插入和删除一个串到 $\mathrm{Trie}$ 树，以及查询一个串的答案的时间复杂度显然是 $O(64)$。

而每个串至多被插入、删除、查询各一次，因此到此处时间复杂度为 $O(64n)$。

如果采用倒序插入，则时间复杂度就是 $O(64n)$。

如果采用排序加二分查找，则总体时间复杂度为 $O(64n + n \log n)$。

而对于空间存储，由于插入的串至多产生 $64n$ 个节点，而每个节点只维护了左节点、右节点、经过次数（最晚经过编号）三个信息，因此空间复杂度为 $O(64n)$，常数约为 $3$ 倍（其他数组相比较而言常数较小）。

计算可得大致占用空间为 $128 \, \mathrm{MB} \times 3 = 384 \, \mathrm{MB} << 512 \, \mathrm{MB}$，满足要求。

### 三、问题与解决

本题还需考虑不能与自身异或这个要求，容易发现，这只有在第 $1$ 个串才可能出现。

因此只须采取特判即可解决。

