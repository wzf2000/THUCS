## PA1a-5 Polynomial

### 一、算法分析

首先考虑不存在 $x$ 的情况，那么本题相当于一个中缀表达式求值的过程。

于是我们可以先将中缀表达式转为后缀表达式，再通过后缀表达式求值得出结果。

具体来说，首先是中缀表达式转为后缀表达式，我们需要将读入的表达式顺序遍历：

1. 如果遇到 `'('`，则直接将其加入栈中；
2. 如果遇到 `')'`，则持续将栈顶元素弹出并加入后缀表达式直到遇到 `'('`，弹出并结束循环。
3. 如果遇到运算符，则将栈顶元素中优先级大于等于其优先级的运算符弹出并将其加入后缀表达式，再将其压入栈中；
4. 如果遇到数字，则持续向后遍历，直到不再为数字，将这些数字合并为一个完整的数加入后缀表达式。

然后是后缀表达式求值的过程，我们仍然遍历后缀表达式中的每个元素：

1. 如果是运算符 $op$，则取出栈顶的两个元素 $a, b$，执行运算 $op(b, a)$ 并将结果压入栈中；
2. 否则，读入这个数并压入栈中。

最终栈中仅存的数就是计算结果。

而对于含 $x$ 也就是多项式的情况，其实也基本类似，我们也只需将计算对象由数改为多项式即可，而基本的单元从数字改为数字和 $x$ 即可。

具体来说，我们可以编写一个多项式类 `class Poly`，重载其 `+`、`-`、`*`、`^` 运算符，对于单独的数相当于常数多项式 $f(x) = C$，而对于 $x$ 则相当于一次多项式 $f(x) = x$。

之后只须重复上面的过程即可完成本题。

### 二、复杂度分析

由于对于读入的每个字符（单元），至多被压入和弹出栈两次，故进行的操作数为 $O(n)$。

而单次运算的复杂度至多为 $k$ 次乘法，故时间复杂度为 $O(n k m^2)$。

考虑到 $m$ 实际为计算过程中的最高项次数，而 $k$ 次幂的情况下，单个多项式的次数至多为 $\dfrac{m}{k}$，因此实际上算法的常数极小。

而空间复杂度为 $O(nm)$，但由于长度为 $n$ 的输入实际可贡献的多项式个数至多为 $\dfrac{n}{2}$ 并且程序采用了动态内存管理，所以算法的空间也不可能超出限制（大约最大占用空间为 $500000 \times 65 \times 4 \, \mathrm{B} \approx 125 \, \mathrm{MB}
$）。

### 三、问题与解决

本题给出的输入可能存在省略乘号的情况，因此在中缀表达式转后缀表达式的过程中，需要通过特判得出当前位置是否满足省略称号的条件，并进而将乘号手动插入其中。

